{# MERGE OUR TABS INTO A SINGLE DATA OBJECT #}
{% set data = merge_data(cubs=CUBS_DATA,cardinals=CARDINALS_DATA, brewers=BREWERS_DATA) %}


{% macro standings_block(team) %}
	{% set svg_url = team['team_name']|team_lookup('abbrev') %}
	{% set place = team['current_division_rank']|format_ranking %}
	{% set team_name = team['team_name']|team_lookup('readable') %}
	{% set games_back = team['current_games_back'] %}
	{% set current_record = team['current_record']%}

	<div class='standing standing--{{ team["team_name"] }}'>
		<h2 class='standing__place'>{{ place|upper }} PLACE</h2>
		<div class='standing__logo'>
			<svg>
			  <use xlink:href="#{{ svg_url }}" />
			</svg>
		</div>
		<h3 class='standing__team'>{{ team_name }}</h3>
		<dl class='standing__stats'>
			<dt>Record</dt>
			<dd>{{ current_record['wins'] }}-{{ current_record['losses'] }}</dd>			
			<dt>Games back</dt>
			<dd>{{ games_back }}</dd>
		</dl>
	</div>

{% endmacro%}

{% macro next_seven_games(team) %}
	{% set team_name = team['team_name']|team_lookup('readable') %}
	{% set svg_url = team['team_name']|team_lookup('abbrev') %}

	<h3 class='next-seven__team'>{{ team_name }}</h3>
	<div class='next-seven next-seven--{{ team["team_name"]}}'>
		{% for game in team['next_seven_games'] %}
			{% set date = game['game_date']|format_date_time('%b %-d') %}
			{% if game['location'] == 'home' %}
				{% set home_road = "" %}
			{% else %}
				{% set home_road = "@" %}
			{% endif %}
			{% set opponent = game['opponent'] %}
			<div class='next-seven__game game'>
				<h4 class='game__date'>{{ date }}</h4>
				<p class='game__opponent'>{{ home_road }}{{ opponent }}</p>
				<svg class='game__opponent-logo'>
			  		<use xlink:href="#{{ opponent }}" /></use>
				</svg>
			</div>
		{% endfor %}
	</div>
{% endmacro %}

{% block content %}
	<script>
		window.data = {{ data|jsonify }};
	</script>

	<div style='display:none;height:0'>{% include 'img/sprite.svg' %}</div>
	<div class='graphic-wrapper'>
		<section class='intro'>
			{{ intro|markdown }}
			<p>Standings as of {{ updated_date|format_date_time('%-I:%M, %p %b %-d') }}</p>
		</section>
		<section class='standings'>
			
			{% for team in data %}
				{{ standings_block(team) }}
			{% endfor %}			
		</section>

		<section class='horse-race'>
			<div id='horse-race' class='chart'></div>
		</section>
		<section class='next-seven-games'>
			{% for team in data %}
				{{ next_seven_games(team) }}
			{% endfor %}			
		</section>
	</div>
{% endblock content %}

{% block library_scripts %}
{# Uncomment this if you are using libraries such as jQuery #}
<script src="//{{ ROOT_URL }}/js/vendor.min.js"></script>
{% endblock %}

{% block scripts %}
{# Uncomment this if you are using custom JavaScript #}
<script src="//{{ ROOT_URL }}/js/app.min.js"></script>
<script>
(function(document) {
  var CSS = [
    "//{{ ROOT_URL }}/css/styles.css"
  ];
  CSS.forEach(function(url) {
    var link = document.createElement('link');
    link.setAttribute('rel', 'stylesheet');
    link.setAttribute('href', url);
    document.head.appendChild(link);
  });
})(document);
</script>
{% endblock scripts %}
